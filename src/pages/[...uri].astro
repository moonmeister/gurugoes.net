---
import type {
	GetStaticPaths,
	InferGetStaticParamsType,
	InferGetStaticPropsType,
} from "astro";
import { getSeedQuery } from "../lib/client";
import { getTemplate } from "../lib/templates";

export const getStaticPaths = (async () => {
	const posts = [
		{ uri: "/" },
		{ uri: "/category/hiking/" },
		{ uri: "/hiking/fkt-appalachian-high-route/" },
		{ uri: "/cdt/lake-city-to-salida-co/" },
	];
	return posts.map((post) => {
		return {
			params: { uri: post.uri },
		};
	});
}) satisfies GetStaticPaths;

type Params = InferGetStaticParamsType<typeof getStaticPaths>;
type Props = InferGetStaticPropsType<typeof getStaticPaths>;

// export const prerender = false;

const { uri = "/" } = Astro.params as Params;
// const uri = Astro.url.pathname;

const { data } = await getSeedQuery({ uri });

const template = await getTemplate(data.nodeByUri);

Astro.locals.uri = uri;
return Astro.rewrite(template?.path);
---

<div>Something is wrong if you're seeing this</div>
<pre>{JSON.stringify(template, null, 2)}</pre>
<pre>{JSON.stringify(data, null, 2)}</pre>
